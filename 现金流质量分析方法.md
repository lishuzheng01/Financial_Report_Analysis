# 现金流质量分析技术方法

## 目标
衡量企业盈利的现金兑现程度与再投资可持续性，识别经营现金流的稳定性与资本开支压力，为偿债、分红和再投资决策提供依据。

## 适用范围
- 利用现金流量表与利润表数据
- 单公司多期趋势分析
- 同业/行业对标（需引入基准数据）

## 指标体系
- 经营现金流/净利润比 = 经营活动现金流净额 / 净利润
- 现金再投资比率 = (资本开支 - 折旧摊销) / 经营活动现金流净额
- 自由现金流（FCF） = 经营活动现金流净额 - 资本开支
- 稳定性参考：上述指标的变异系数（CV）、滚动标准差或区间最小/最大值

## 计算规则
- 分母为 0 时输出为空或标记不可计算
- 结果建议保留 2 位小数，比例类指标可用百分比格式
- 稳定性：可使用最近 N 期（默认 4~8 期）计算标准差、均值及 CV = 标准差 / 均值

## 输出形式
- 输出内容：markdown 报告 + 可视化图片
- markdown 输出规范：
  - 报告开头添加提示：“prompt：请在适当的位置插入图片，严格遵守 markdown 图片的插入规范，图片内容如下：图片1...”并与生成图片名称严格一致
  - 提供指标表（按报告期）、稳定性摘要（均值/标准差/CV）与趋势图

## 建议实现方式
1. 新增模块：`src/report_data_cashflow_quality.py`
2. 数据读取：复用 `report_data_reader`
3. 字段映射（参考 `表头.txt`）：
   - 经营活动现金流净额：`Net Cash Flow from Operating Activities`
   - 净利润：`Net Profit`（备选 `Net Profit Attributable to Parent`）
   - 资本开支：`Cash Paid for Acquisition of Fixed Assets, Intangible Assets, and Other Long-term Assets`
   - 折旧摊销（如需调整再投资比率，可选）：`Asset Impairment Loss` + `Depreciation`/`Amortization`（表头未提供折旧/摊销专列，缺失时可暂置 0 并在报告中说明）
4. 指标计算：
   - OCF/净利润比 = OCF / 净利润
   - 现金再投资比率 = (资本开支 - 折旧摊销) / OCF
   - FCF = OCF - 资本开支
   - 稳定性：对 OCF/净利润比、现金再投资比率、FCF 计算均值、标准差、CV
5. 可视化：
   - 趋势图展示 OCF/净利润比、现金再投资比率、FCF（可双轴或分图）
   - 稳定性可视化：可用条形图展示 CV 或标准差
6. 输出目录：`stock_report_data/{code}/cashflow_quality`
7. 支持参数：`cashflow_quality_analysis(symbol, number)`（number 为分析期数）

## 注意事项
- 报告期频率差异（年报/季报）需提示
- 净利润为负或接近 0 时，OCF/净利润比可能失真，需在报告中提示
- 若资本开支缺失，以 0 代替时需注明假设；如后续补充折旧摊销，更新计算与说明

## 调用规范
`cashflow_quality_analysis(symbol, number)`
- `symbol`：股票代码
- `number`：分析期数，按时间倒序取最近 number 期
