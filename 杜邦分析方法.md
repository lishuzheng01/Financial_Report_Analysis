# 杜邦分析技术方法

## 目标
将 ROE 分解为净利率、总资产周转率与权益乘数，明确股东收益率的来源，并支撑纵向趋势与横向对标的解释。

## 适用范围
- 利用利润表、资产负债表数据
- 单公司多期趋势分析
- 同业/行业对标（需引入基准数据）

## 指标体系
- ROE = 净利润 / 平均股东权益
- 净利率 = 净利润 / 营业收入
- 总资产周转率 = 营业收入 / 平均总资产
- 权益乘数 = 平均总资产 / 平均股东权益
- 三步杜邦分解：ROE = 净利率 × 总资产周转率 × 权益乘数

## 计算规则
- 平均值统一取 (期初 + 期末) / 2
- 分母为 0 时输出为空或标记不可计算
- 结果建议保留 2 位小数，并对比例类指标提供百分比格式

## 输出形式
- 输出内容：markdown 报告 + 可视化图片
- markdown 输出规范：
  - 在 markdown 报告开头插入提示：“prompt：请在适当的位置插入图片，严格遵守 markdown 图片的插入规范，图片内容如下：图片1...”并与生成的图片名称严格一致
  - 提供杜邦三分解指标表格（按报告期排列）
  - 附上 ROE 及分项趋势图

## 建议实现方式
1. 新增模块：`src/report_data_dupont_analysis.py`
2. 数据读取：复用 `report_data_reader`
3. 指标计算：
   - 基于表头文件（如 `表头.txt`）中的英文字段，统一映射为：`Net Profit`（`Net Profit`/`Net Profit Attributable to Parent`）、`Operating Revenue`（`Operating Revenue`/`Total Operating Revenue`）、`Total Assets`、`Equity Base`（`Total Equity Attributable to Shareholders of the Parent Company` 或 `Total Owner's Equity (or Shareholders' Equity)`）
   - 平均总资产、平均股东权益用于周转率与 ROE/权益乘数
4. 可视化：
   - 单图展示 ROE、净利率、总资产周转率、权益乘数趋势（折线/双轴按需）
5. 输出目录：`stock_report_data/{code}/dupont_analysis`
6. 支持参数：`dupont_analysis(symbol, number)`（number 为分析期数）

## 字段对照（基于 `表头.txt`）
- 资产负债表（balance_sheet）：
  - 总资产：`Total Assets`
  - 股东权益：`Total Equity Attributable to Shareholders of the Parent Company`，备选：`Total Owner's Equity (or Shareholders' Equity)`
- 利润表（profit_sheet）：
  - 营业收入：`Operating Revenue`，备选：`Total Operating Revenue`
  - 净利润：`Net Profit`，备选：`Net Profit Attributable to Parent`
- 计算用衍生字段：
  - 平均总资产 = (期初总资产 + 期末总资产) / 2
  - 平均股东权益 = (期初权益 + 期末权益) / 2

## 注意事项
- 报告期频率差异（年报/季报）需提示
- 横向对标时注明样本范围、日期
- 若权益为负或接近 0，需提示结果解释风险

## 调用规范
`dupont_analysis(symbol, number)`
- `symbol`：股票代码
- `number`：分析期数，按时间倒序取最近 number 期
